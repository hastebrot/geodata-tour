<!DOCTYPE html>
<meta charset="utf-8">
<title>Story #1: Basic Example</title>
<style>

  html, body, #map {
    height: 100%;
    margin: 0;
    padding: 0;
  }

  body {
    /*background: #fcfcfa;*/
    font: 300 14px "Helvetica Neue", Helvetica;
  }

</style>
<body>
<link rel="stylesheet" href="../../../bower_components/ol3/dist/ol.css" type="text/css">
<script src="../../../bower_components/lodash/dist/lodash.js"></script>
<script src="../../../bower_components/ol3/dist/ol.js"></script>
<script src="../../../bower_components/jsts/dist/javascript.util.js"></script>
<script src="../../../bower_components/jsts/dist/jsts.js"></script>

<div id="map" class="map"></div>

<script>
  var reader = new jsts.io.WKTReader();
  var a = reader.read("POLYGON((0 100, 100 100, 100 200, 0 200, 0 100))");
  var b = reader.read("POLYGON((50 0, 200 0, 200 150, 50 150, 50 0))");

  var union = a.union(b);
  var intersection = a.intersection(b);

  var magentaGeometries = [a];
  var cyanGeometries = [b];
  var resultGeometries = [intersection];

  var format = new ol.format.WKT();

  var magentaStyle = [
    new ol.style.Style({
      fill: new ol.style.Fill({color: "rgba(155, 155, 155, 0.2)"}),
      stroke: new ol.style.Stroke({color: "magenta", width: 3, lineDash: [0.5, 5]})
    })
  ];
  var cyanStyle = [
    new ol.style.Style({
      fill: new ol.style.Fill({color: "rgba(155, 155, 155, 0.2)"}),
      stroke: new ol.style.Stroke({color: "cyan", width: 3, lineDash: [0.5, 5]})
    })
  ];
  var resultStyle = [
    new ol.style.Style({
      fill: new ol.style.Fill({color: "rgba(155, 155, 155, 0.2)"}),
      stroke: new ol.style.Stroke({color: "gray", width: 3})
    })
  ];

  var magentaLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
      features: _.map(magentaGeometries, function(geometry) {
        var feature = format.readFeature(geometry.toString());
        //feature.getGeometry().transform('EPSG:4326', 'EPSG:3857');
        return feature;
      })
    }),
    style: magentaStyle
  });

  var cyanLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
      features: _.map(cyanGeometries, function(geometry) {
        var feature = format.readFeature(geometry.toString());
        //feature.getGeometry().transform('EPSG:4326', 'EPSG:3857');
        return feature;
      })
    }),
    style: cyanStyle
  });

  var resultLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
      features: _.map(resultGeometries, function(geometry) {
        var feature = format.readFeature(geometry.toString());
        //feature.getGeometry().transform('EPSG:4326', 'EPSG:3857');
        return feature;
      })
    }),
    style: resultStyle
  });


  var map = new ol.Map({
    layers: [magentaLayer, cyanLayer, resultLayer],
    target: "map",
    logo: false
  });

  var extent = _.chain(map.getLayers().getArray())
      .map(function(layer) {
        return layer.getSource().getExtent()
      })
      .reduce(function(result, item) {
        return ol.extent.extend(result, item)
      })
      .value();
  map.getView().fitExtent(extent, map.getSize());

</script>
